<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Edunancial Admin – Pricing Config</title>
<link rel="stylesheet" href="css/style.css">
<style>
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; padding:1rem; }
  textarea { width:100%; min-height:60vh; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size:.95rem; }
  .row { display:flex; gap:.5rem; flex-wrap:wrap; margin:.75rem 0; }
  button { padding:.6rem 1rem; border-radius:10px; border:1px solid #111; background:#111; color:#fff; cursor:pointer; }
  button.secondary { background:#fff; color:#111; }
  .status { margin-top:.5rem; color:#0a7; }
  .error { color:#c00; }
</style>
</head>
<body>
  <h1>Edunancial Admin – Pricing Config</h1>
  <p>Load, edit, and save the pricing config. Use <strong>Export</strong> to download a JSON you can paste back into <code>pricing-config.js</code>.</p>

  <div class="row">
    <button id="load-live">Load from window.EDU_PRICING_CONFIG</button>
    <button id="load-local" class="secondary">Load from LocalStorage</button>
    <button id="save-local">Save to LocalStorage</button>
    <button id="export-file" class="secondary">Export JSON</button>
    <label class="secondary" style="border:1px solid #111; border-radius:10px; padding:.5rem 1rem; cursor:pointer;">
      Import JSON<input id="import-file" type="file" accept="application/json" style="display:none">
    </label>
  </div>

  <textarea id="editor" spellcheck="false" placeholder="// JSON will appear here"></textarea>
  <div id="msg" class="status"></div>

  <!-- Load the live config so the button can read it -->
  <script src="pricing-config.js"></script>
  <script>
    const KEY = "EDU_CONFIG_JSON";

    const $ = (s)=>document.querySelector(s);
    const msg = $("#msg");
    const editor = $("#editor");

    function setMsg(text, isErr=false){
      msg.textContent = text || "";
      msg.className = isErr ? "status error" : "status";
    }

    $("#load-live").onclick = () => {
      try {
        if (!window.EDU_PRICING_CONFIG) throw new Error("EDU_PRICING_CONFIG not found (is pricing-config.js loaded?)");
        const clone = JSON.parse(JSON.stringify(window.EDU_PRICING_CONFIG));
        editor.value = JSON.stringify(clone, null, 2);
        setMsg("Loaded config from window.EDU_PRICING_CONFIG");
      } catch (e) { setMsg(e.message, true); }
    };

    $("#load-local").onclick = () => {
      try {
        const txt = localStorage.getItem(KEY);
        if (!txt) throw new Error("No LocalStorage config found");
        editor.value = txt;
        setMsg("Loaded config from LocalStorage");
      } catch (e) { setMsg(e.message, true); }
    };

    $("#save-local").onclick = () => {
      try {
        const obj = JSON.parse(editor.value);
        localStorage.setItem(KEY, JSON.stringify(obj));
        setMsg("Saved to LocalStorage");
      } catch (e) { setMsg("Invalid JSON: " + e.message, true); }
    };

    $("#export-file").onclick = () => {
      try {
        const obj = JSON.parse(editor.value);
        const blob = new Blob([JSON.stringify(obj, null, 2)], {type: "application/json"});
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "edunancial-pricing-config.json";
        a.click();
        setMsg("Exported file");
      } catch (e) { setMsg("Invalid JSON: " + e.message, true); }
    };

    $("#import-file").onchange = async (e) => {
      const file = e.target.files?.[0];
      if (!file) return;
      const txt = await file.text();
      try {
        JSON.parse(txt);
        editor.value = txt;
        setMsg("Imported JSON");
      } catch (err) {
        setMsg("Invalid JSON file: " + err.message, true);
      }
    };
  </script>
</body>
</html>
