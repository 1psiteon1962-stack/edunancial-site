<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Checkout — Edunancial</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <!-- Global header (red banner, nav, EN/ES toggle) -->
  <div id="sitebar"></div>
  <script src="/header.js"></script>

  <main class="container">
    <section class="card">
      <h1>Checkout</h1>
      <p><strong>SKU:</strong> <span id="sku">EDN-CRS-MIX-001</span></p>

      <form id="payForm" class="stack" novalidate>
        <div class="row">
          <label for="agecode" class="label">Discount / Under-18 Code</label>
          <input id="agecode" name="agecode" type="text" inputmode="text" autocomplete="off" placeholder="Enter code" class="input" />
        </div>

        <p class="muted">Price:</p>
        <p class="price"><span id="currency">$</span><span id="amount" data-base="75.00">75.00</span></p>

        <a id="toPayPal" class="btn btn-primary" href="#">
          Continue to PayPal
        </a>

        <p class="tiny muted">
          By paying you agree to our <a href="/terms.html">Terms</a> and <a href="/refunds.html">Refunds</a>.
        </p>
      </form>
    </section>
  </main>

  <footer class="container tiny muted">© 2025 Edunancial, Inc.</footer>

  <script>
  (function () {
    // ---- Pricing rules for TEST ONLY (reduce to $3.00 when a non-empty code is applied) ----
    // Nothing changes automatically. User must type a code (any non-empty string) to trigger $3.00 for testing.
    var amountEl = document.getElementById('amount');
    var agecode  = document.getElementById('agecode');
    var btn      = document.getElementById('toPayPal');

    function getBase() {
      var b = parseFloat(amountEl.getAttribute('data-base') || '0');
      return isFinite(b) ? b : 0;
    }
    function setAmount(v) {
      amountEl.textContent = Number(v).toFixed(2);
    }
    function computeAmount() {
      var code = (agecode.value || '').trim();
      if (code.length > 0) return 3.00;            // test: any non-empty code → $3.00
      return getBase();                             // no code → base price
    }

    function refreshAmount() {
      setAmount(computeAmount());
    }
    agecode.addEventListener('input', refreshAmount);

    // ---- PayPal link hardening (absolute return/cancel with .html; preserve your existing link) ----
    var isES = false; // this is EN page
    var returnUrl = location.origin + '/thank-you.html';
    var cancelUrl = location.origin + '/checkout.html';

    // If the anchor already has your working PayPal URL, we won't replace it—only patch params.
    // If it's empty, we leave it as # (so you can still navigate back) but it will not break layout.
    btn.addEventListener('click', function (e) {
      // ensure current amount is pushed into URL & return targets are set
      var href = btn.getAttribute('href') || '';
      if (!href || href === '#') {
        // leave as-is (no public secrets exposed here)
        return;
      }
      try {
        var u = new URL(href);
        u.searchParams.set('return', returnUrl);
        u.searchParams.set('cancel_return', cancelUrl);
        u.searchParams.set('amount', Number(computeAmount()).toFixed(2));
        btn.setAttribute('href', u.toString());
      } catch (_) {}
    });

    // Initial display
    refreshAmount();
  })();
  </script>
</body>
</html>
