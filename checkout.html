<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Checkout — Edunancial</title>
  <style>
    body { margin:0; font-family:Arial, sans-serif; background:#fff; color:#111; }
    header { background:#c50000; color:#000; text-align:center; font-weight:700; padding:14px; }
    main { max-width:700px; margin:30px auto; padding:0 15px; }
    .card { border:1px solid #ddd; border-radius:10px; padding:20px; box-shadow:0 4px 12px rgba(0,0,0,0.08); }
    h1 { margin-top:0; }
    label { display:block; margin:12px 0 6px; font-weight:bold; }
    input[type="text"] { width:100%; padding:10px; border:1px solid #ccc; border-radius:6px; }
    .row { display:flex; justify-content:space-between; margin:8px 0; }
    .total { font-size:22px; font-weight:700; }
    #paypal-button-container { margin-top:20px; }
    .help { display:none; margin-top:15px; padding:12px; border:1px solid #d00; background:#ffeaea; border-radius:6px; color:#900; }
  </style>

  <!-- LIVE PayPal SDK -->
  <script src="https://www.paypal.com/sdk/js?client-id=AX2d6TWWguiffoGPIhKQg5D4avOwsBajcdl-S2tJ7mAHckP_sxucKRXdCgYyyQRQYqKGvWlE2wx4GAxw&currency=USD&components=buttons"></script>
</head>
<body>
  <header>EDUNANCIAL CHECKOUT</header>
  <main>
    <div class="card">
      <h1>Mini Course: Edunancial Method</h1>
      <p>SKU: EDN-MINI-EM-001</p>

      <label><input type="checkbox" id="under18"> I am under 18</label>
      <label for="code">Discount / Under-18 Code</label>
      <input id="code" type="text" placeholder="Enter code (PR12345$$ for test)" />

      <div class="row"><span>Subtotal</span> <span id="subtotal">$75.00</span></div>
      <div class="row"><span>Early-bird</span> <span id="earlybird">-$11.25</span></div>
      <div class="row"><span>Under-18 code</span> <span id="u18">-$0.00</span></div>
      <div class="row total"><span>Total</span> <span id="total">$63.75</span></div>

      <div id="paypal-button-container"></div>
      <div id="paypal-help" class="help">
        ⚠️ PayPal button not showing? Please disable ad-blocker/Private DNS or try Wi-Fi/mobile data. Then refresh.
      </div>
    </div>
  </main>

  <script>
    const SUBTOTAL=75.00, EARLYBIRD=11.25, TEST_CODE="PR12345$$";
    const $u18=document.getElementById("under18"),
          $code=document.getElementById("code"),
          $uline=document.getElementById("u18"),
          $tot=document.getElementById("total");

    function fmt(n){return "$"+n.toFixed(2);}
    function calcTotal(){
      let u18=0;
      if($u18.checked && $code.value.trim()===TEST_CODE){
        let current=SUBTOTAL-EARLYBIRD;
        u18=current-1.00; // force $1 total
      }
      $uline.textContent="-"+(u18?u18.toFixed(2):"0.00");
      let total=SUBTOTAL-EARLYBIRD-u18;
      $tot.textContent=fmt(total);
      return total.toFixed(2);
    }
    ["change","keyup"].forEach(ev=>{
      $u18.addEventListener(ev,calcTotal);
      $code.addEventListener(ev,calcTotal);
    });
    calcTotal();

    function renderPayPal(){
      if(!window.paypal){document.getElementById("paypal-help").style.display="block";return;}
      paypal.Buttons({
        createOrder:(data,actions)=>{
          let amount=calcTotal();
          return actions.order.create({
            purchase_units:[{description:"Edunancial Mini Course (EN)",amount:{currency_code:"USD",value:amount}}]
          });
        },
        onApprove:(data,actions)=>{
          return actions.order.capture().then(det=>{
            const params=new URLSearchParams({
              orderId:det.id||"",
              paid:calcTotal(),
              payer:(det.payer && det.payer.name && det.payer.name.given_name)||"Customer"
            }).toString();
            window.location.href="/thank-you.html?"+params;
          });
        },
        onError:()=>{document.getElementById("paypal-help").style.display="block";}
      }).render("#paypal-button-container");
    }
    document.addEventListener("DOMContentLoaded",()=>{
      renderPayPal();
      setTimeout(()=>{
        if(!document.querySelector("#paypal-button-container iframe")){
          document.getElementById("paypal-help").style.display="block";
        }
      },4000);
    });
  </script>
</body>
</html>
