<!doctype html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Checkout â€” Edunancial</title>
<link rel="stylesheet" href="/style.css">
<style>
  .form-row{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
  .codebox{display:inline-flex;gap:8px}
  .total{font-size:22px;font-weight:800;margin:12px 0}
</style>
</head><body>
<div id="sitebar"></div>

<main class="container">
  <h1>Checkout</h1>
  <p id="skuLine"></p>

  <div class="form-row">
    <label><input type="checkbox" id="ageChk"> I am under 18</label>
    <span>|</span>
    <div class="codebox">
      <label for="code">Discount / Under-18 Code:</label>
      <input id="code" type="text" inputmode="text" placeholder="Enter code">
      <button id="apply" class="btn">Apply</button>
    </div>
  </div>

  <div class="total">Total: <span id="total">$0.00</span></div>

  <a id="payLink" class="btn btn-primary" href="#">Continue to PayPal</a>
  <p class="muted">By paying you agree to our <a href="/terms.html">Terms</a> and <a href="/refunds.html">Refunds</a>.</p>
</main>

<script src="/header.js"></script>
<script>
(function(){
  const params = new URLSearchParams(location.search);
  const sku = params.get('sku') || 'UNKNOWN';
  const base = Number(params.get('price') || 0);
  const skuLine = document.getElementById('skuLine');
  const totalEl = document.getElementById('total');
  const ageChk = document.getElementById('ageChk');
  const codeEl = document.getElementById('code');
  const applyBtn = document.getElementById('apply');
  const payLink = document.getElementById('payLink');

  skuLine.textContent = 'SKU: ' + sku;
  let total = base;
  render();

  // Do NOT change price until a valid code is applied
  applyBtn.onclick = (e)=>{
    e.preventDefault();
    const code = (codeEl.value||'').trim().toUpperCase();

    // Valid test codes => force total to $3.00
    const validCodes = ['PR18','TEST3','EDN3']; // keep/add as needed
    if (ageChk.checked && validCodes.includes(code)) {
      total = 3.00;
      render();
    } else {
      alert('Invalid or missing code. Total unchanged.');
    }
  };

  function render(){
    totalEl.textContent = `$${total.toFixed(2)}`;
    // Build PayPal route you already use (preserve your backend)
    const query = new URLSearchParams({ sku, amount: total.toFixed(2) }).toString();

    // If your site defines PAYPAL_URL_BASE (via config-loader.js), use it
    const baseUrl = window.PAYPAL_URL_BASE || "/.netlify/functions/paypal-checkout";
    payLink.href = `${baseUrl}?${query}`;
  }
})();
</script>
</body></html>
