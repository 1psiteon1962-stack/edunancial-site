<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Checkout — Edunancial</title>
<link rel="stylesheet" href="style.css" />
<!-- PayPal SDK — LIVE client ID from your app -->
<script src="https://www.paypal.com/sdk/js?client-id=AX2d6TWWguiffoGPIhKQg5D4avOwsBajcdl-S2tJ7mAHckP_sxucKRXdCgYyyQRQYqKGvWlE2wx4GAxw&currency=USD&components=buttons"></script>
</head>
<body>
<header>EDUNANCIAL CHECKOUT</header>
<nav>
  <a href="index.html">Our Story</a>
  <a href="courses.html">Courses</a>
  <a href="books.html">Books</a>
  <a href="checkout.html">Checkout</a>
  <a href="contact.html">Contact</a>
</nav>

<main class="grid grid-2">
  <section class="card">
    <h1 class="h1">Mini Course: Edunancial Method (EN)</h1>
    <p class="muted">SKU: EDN-MINI-EM-001</p>

    <label for="code">Discount / Under-18 Code</label>
    <input id="code" type="text" placeholder="Enter code (PR12345$$ for your $1 test)" autocomplete="off" />

    <div class="inline" style="margin-top:8px">
      <input type="checkbox" id="under18" />
      <label for="under18" style="margin:0">I am under 18</label>
    </div>

    <div class="card" style="margin-top:12px">
      <div class="row"><span>Subtotal</span>     <span id="subtotal">$75.00</span></div>
      <div class="row"><span>Early-bird</span>    <span id="earlybird">-$11.25</span></div>
      <div class="row"><span>Under-18 code</span> <span id="u18line">-$0.00</span></div>
      <div class="row total"><span>Total</span>   <span id="total">$63.75</span></div>
    </div>

    <p class="muted">By paying you agree to our <a href="terms.html">Terms</a> and <a href="refunds.html">Refunds</a>.</p>
  </section>

  <aside class="card">
    <div class="h2">Pay securely with PayPal</div>
    <div id="paypal-button-container" style="margin-top:10px;min-height:45px"></div>
    <div id="pp-error" class="warn" style="display:none;margin-top:10px"></div>
    <div id="paypal-help" class="warn" style="display:none;margin-top:10px">
      ⚠️ The PayPal checkout button didn’t load.<br><br>
      Please disable <strong>ad-blockers</strong> or <strong>Private DNS</strong> on your phone/browser, or try switching between Wi-Fi and mobile data. Then refresh this page. (Allow scripts from <em>paypal.com</em>.)
    </div>
  </aside>
</main>

<footer>© <span id="y"></span> Edunancial, Inc.</footer>
<script>document.getElementById('y').textContent=new Date().getFullYear()</script>

<script>
const SUBTOTAL=75.00, EARLYBIRD=11.25, TEST_CODE="PR12345$$";
const $u18=document.getElementById('under18'), $code=document.getElementById('code');
const $uLine=document.getElementById('u18line'), $tot=document.getElementById('total');
function fmt(n){return '$'+Number(n).toFixed(2)}
function calcTotal(){
  let u18Disc=0; if($u18.checked && $code.value.trim()===TEST_CODE){u18Disc=Math.max(0,(SUBTOTAL-EARLYBIRD)-1)}
  $uLine.textContent='-'+(u18Disc?fmt(u18Disc).slice(1):'0.00');
  const total=Math.max(0.01,SUBTOTAL-EARLYBIRD-u18Disc); $tot.textContent=fmt(total); return Number(total.toFixed(2));
}
document.getElementById('subtotal').textContent=fmt(SUBTOTAL);
document.getElementById('earlybird').textContent='-'+fmt(EARLYBIRD).slice(1);
['change','keyup'].forEach(ev=>{$u18.addEventListener(ev,calcTotal);$code.addEventListener(ev,calcTotal)});calcTotal();

const $help=document.getElementById('paypal-help'), $err=document.getElementById('pp-error');
function renderPayPal(){
  if(!window.paypal||!paypal.Buttons){$help.style.display='block';return;}
  $help.style.display='none'; $err.style.display='none';
  paypal.Buttons({
    style:{layout:'vertical',color:'gold',shape:'rect',label:'paypal'},
    createOrder:(data,actions)=>{
      const amount=calcTotal(); if(amount<1){$err.textContent='Total must be at least $1.00.';$err.style.display='block';throw new Error('Total below 1.00');}
      return actions.order.create({purchase_units:[{description:'Edunancial Mini Course (EN)',custom_id:'EDN-MINI-EM-001',amount:{currency_code:'USD',value:amount.toFixed(2)}}]});
    },
    onApprove:(data,actions)=>actions.order.capture().then(details=>{
      const q=new URLSearchParams({orderId:details.id||'',paid:calcTotal().toFixed(2),payer:(details.payer&&details.payer.name&&details.payer.name.given_name)||'Customer'}).toString();
      location.href='thank-you.html?'+q;
    }),
    onError:(err)=>{$err.textContent='PayPal error: '+(err&&err.message?err.message:'Unknown.');$err.style.display='block';$help.style.display='block';}
  }).render('#paypal-button-container').catch(()=>{$help.style.display='block';});
}
document.addEventListener('DOMContentLoaded',()=>{renderPayPal();setTimeout(()=>{if(!document.querySelector('#paypal-button-container iframe')){$help.style.display='block'}},5000);});
</script>
</body>
</html>
