<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Checkout — Edunancial</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <div id="sitebar"></div><script src="/header.js"></script>

  <main class="container">
    <section class="card">
      <h1>Checkout</h1>
      <p class="sku" id="sku">SKU: (loading…)</p>

      <div style="display:flex; gap:18px; align-items:center; flex-wrap:wrap">
        <label><input type="checkbox" id="u18"> I am under 18</label>
        <label> Discount / Under-18 Code:
          <input id="code" type="text" placeholder="optional" style="padding:8px;border-radius:8px;border:1px solid #ccc">
        </label>
      </div>

      <p>Total: <span class="price" id="total">$0.00</span> <span id="badge" style="font-weight:800;color:#0a0"></span></p>

      <a id="go" class="btn btn-primary" href="#">Continue to PayPal</a>
      <p style="margin-top:8px; color:#666">By paying you agree to our <a href="/terms.html">Terms</a> and <a href="/refunds.html">Refunds</a>.</p>
    </section>
  </main>

  <script>
    // Read incoming SKU/price
    const q = new URLSearchParams(location.search);
    const basePrice = parseFloat(q.get('price') || '0');   // original price
    const sku = q.get('sku') || 'EDN-ITEM';
    document.getElementById('sku').textContent = 'SKU: ' + sku;

    // Elements
    const codeEl = document.getElementById('code');
    const u18El = document.getElementById('u18');
    const totalEl = document.getElementById('total');
    const badgeEl = document.getElementById('badge');
    const go = document.getElementById('go');

    // Pricing rule: if under-18 OR code PR12345$$, final total is exactly $3.00 (never $0.00)
    function calc(){
      const hasTestDiscount = u18El.checked || (codeEl.value || '').trim() === 'PR12345$$';
      const total = hasTestDiscount ? 3.00 : basePrice;

      totalEl.textContent = '$' + total.toFixed(2);
      badgeEl.textContent = hasTestDiscount ? 'testing rate applied' : '';

      // Pass amount & sku to payments page
      const paypalLink = '/payments.html?sku=' + encodeURIComponent(sku) + '&amount=' + total.toFixed(2);
      go.href = paypalLink;
    }

    u18El.addEventListener('change', calc);
    codeEl.addEventListener('input', calc);
    calc();
  </script>
</body>
</html>
