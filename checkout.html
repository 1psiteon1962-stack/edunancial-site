<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Checkout — Edunancial</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <div id="sitebar"></div><script src="/header.js"></script>

  <main class="container">
    <section class="card">
      <h1>Checkout</h1>
      <p class="sku" id="sku">SKU: (loading…)</p>

      <div style="display:flex; gap:18px; align-items:center; flex-wrap:wrap">
        <label><input type="checkbox" id="u18"> I am under 18</label>
        <label> Discount / Under-18 Code:
          <input id="code" type="text" placeholder="optional" style="padding:8px;border-radius:8px;border:1px solid #ccc">
        </label>
      </div>

      <p>Total: <span class="price" id="total">$0.00</span></p>

      <a id="go" class="btn btn-primary" href="#">Continue to PayPal</a>
      <p style="margin-top:8px; color:#666">By paying you agree to our <a href="/terms.html">Terms</a> and <a href="/refunds.html">Refunds</a>.</p>
    </section>
  </main>

  <script>
    // Get price/sku from query
    const q = new URLSearchParams(location.search);
    const price = parseFloat(q.get('price') || '0');
    const sku = q.get('sku') || 'EDN-ITEM';
    document.getElementById('sku').textContent = 'SKU: ' + sku;

    // Pricing: $3 off if under-18 OR code PR12345$$ (never free here)
    const codeEl = document.getElementById('code');
    const u18El = document.getElementById('u18');
    const totalEl = document.getElementById('total');
    const go = document.getElementById('go');

    function calc(){
      let discount = 0;
      const code = (codeEl.value || '').trim();
      if (u18El.checked) discount += 3;
      if (code === 'PR12345$$') discount += 3; // stackable if you want
      if (discount > price - 0.01) discount = Math.max(0, price - 0.01); // never zero total
      const total = (price - discount);
      totalEl.textContent = '$' + total.toFixed(2);

      // Keep your existing PayPal flow: pass amount + sku in the return URL.
      // Replace the placeholder 'YOUR_PAYPAL_LINK_HERE' with your hosted button or order link if needed.
      const paypalLink = '/payments.html?sku=' + encodeURIComponent(sku) + '&amount=' + total.toFixed(2);
      go.href = paypalLink;
    }
    u18El.addEventListener('change', calc);
    codeEl.addEventListener('input', calc);
    calc();
  </script>
</body>
</html>
