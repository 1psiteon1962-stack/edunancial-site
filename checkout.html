<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Checkout — Edunancial</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://www.paypal.com" crossorigin>
  <style>
    :root { --red:#c1121f; --blue:#0b3d91; --black:#111; --bg:#f7f7f7; }
    body { margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; background:#fff; color:#111; }
    .banner{background:var(--red);color:#000;text-align:center;font-weight:800;letter-spacing:.5px;padding:.9rem 1rem;}
    .wrap{max-width:820px;margin:24px auto;padding:0 16px;}
    .card{background:#fff;border:1px solid #e6e6e6;border-radius:10px;box-shadow:0 1px 4px rgba(0,0,0,.04);padding:18px 20px;}
    h1{margin:.2rem 0 1rem 0;font-size:1.6rem}
    .row{display:flex;gap:18px;flex-wrap:wrap}
    .col{flex:1 1 320px}
    .sum{font-size:.95rem;line-height:1.55}
    .sum table{width:100%}
    .sum td{padding:.35rem 0;}
    .sum td:last-child{text-align:right}
    .muted{color:#666}
    .input, select{width:100%;padding:.7rem .8rem;border:1px solid #cfcfcf;border-radius:8px;font-size:1rem}
    .check{display:flex;align-items:center;gap:.6rem;margin:.5rem 0}
    .btn{display:inline-block;padding:.75rem 1.1rem;border-radius:8px;border:0;cursor:pointer;font-weight:700}
    .btn-primary{background:var(--blue);color:#fff}
    .note{margin-top:14px;border-left:4px solid #f0b429;background:#fff7ea;padding:.75rem .9rem;border-radius:6px}
    .err{border-left-color:#d33;background:#ffecec}
    #paypal-fail {display:none}
    /* PayPal Standard fallback button */
    .btn-paypal{background:#ffc439;color:#111;width:100%;font-size:1.05rem}
    #pp-standard {display:none;margin-top:10px}
    .tiny{font-size:.85rem}
    .tos{margin-top:10px;color:#666}
  </style>

  <!-- PayPal JS SDK (may be blocked on some networks). Safe to keep. -->
  <script
    src="https://www.paypal.com/sdk/js?client-id=AX2d6TWWguiffoGPIhKQg5D4avOwsBajcdl-S2tJ7mAHckP_sxucKRXdCgYyyQRQYqKGvWlE2wx4GAxw&currency=USD&components=buttons"
    data-sdk-integration-source="button-fallback"
    defer></script>
</head>
<body>
  <div class="banner">EDUNANCIAL CHECKOUT</div>

  <div class="wrap">
    <div class="card">
      <h1>Mini Course: Edunancial Method</h1>
      <p class="muted tiny">SKU: <strong>EDN-MINI-EM-001</strong></p>

      <div class="row">
        <!-- LEFT: options -->
        <div class="col">
          <label class="check">
            <input type="checkbox" id="under18"> I am under 18
          </label>
          <label class="tiny" for="code">Discount / Under-18 Code</label>
          <input id="code" class="input" placeholder="Enter code (use PR12345$$ for $1 test)">
        </div>

        <!-- RIGHT: totals -->
        <div class="col sum">
          <table>
            <tbody>
              <tr><td>Subtotal</td><td id="s-sub">$75.00</td></tr>
              <tr class="muted"><td>Early-bird</td><td id="s-eb">-11.25</td></tr>
              <tr class="muted"><td>Under-18 code</td><td id="s-u18">-0.00</td></tr>
              <tr><td><strong>Total</strong></td><td><strong id="s-total">$63.75</strong></td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- PayPal smart buttons mount here if SDK loads -->
      <div id="paypal-container" style="margin-top:16px"></div>

      <!-- If SDK fails to load, we show this box AND a PayPal Standard fallback button -->
      <div id="paypal-fail" class="note err">
        <strong>PayPal checkout didn’t load.</strong><br>
        Please disable ad-blockers or Private DNS, or switch Wi-Fi/mobile data, then refresh.
      </div>

      <!-- PayPal Payments Standard (no SDK) fallback -->
      <div id="pp-standard">
        <form id="pp-standard-form" action="https://www.paypal.com/cgi-bin/webscr" method="post">
          <input type="hidden" name="cmd" value="_xclick">
          <input type="hidden" name="business" value="PAYPAL_BUSINESS_EMAIL_HERE"><!-- 🔁 replace once -->
          <input type="hidden" name="item_name" value="Mini Course: Edunancial Method (SKU EDN-MINI-EM-001)">
          <input type="hidden" name="currency_code" value="USD">
          <input type="hidden" name="amount" id="pp-amount" value="">
          <input type="hidden" name="custom" id="pp-custom" value="">
          <input type="hidden" name="return" value="https://www.edunancial.com/thank-you.html">
          <input type="hidden" name="cancel_return" value="https://www.edunancial.com/payments.html">
          <button type="submit" class="btn btn-paypal">Pay with PayPal</button>
        </form>
        <div class="tiny muted" style="margin-top:6px">
          This backup button uses PayPal’s hosted checkout and works even if scripts are blocked.
        </div>
      </div>

      <p class="tos tiny">By paying you agree to our <a href="/terms.html">Terms</a> and <a href="/refunds.html">Refunds</a>.</p>
    </div>
  </div>

<script>
(function () {
  // ---------- Pricing rules ----------
  const BASE = 75.00;                 // starter price you set
  const EARLY_BIRD_PCT = 0.15;        // through 09/26/2025
  const EB_DEADLINE = new Date('2025-09-26T23:59:59-05:00'); // adjust tz if needed
  const TEST_CODE = 'PR12345$$';      // $1 test (under-18 must be checked)

  const el = (id)=>document.getElementById(id);
  const under18 = el('under18');
  const code = el('code');
  const sSub = el('s-sub'), sEb = el('s-eb'), sU18 = el('s-u18'), sTotal = el('s-total');

  const fmt = (n)=>'$'+n.toFixed(2);

  function compute() {
    let subtotal = BASE;
    let eb = 0;
    if (new Date() <= EB_DEADLINE) eb = +(BASE * EARLY_BIRD_PCT).toFixed(2);

    let u18 = 0;
    const codeVal = code.value.trim();
    if (under18.checked && codeVal === TEST_CODE) {
      // force total $1 regardless of early-bird
      const target = 1.00;
      u18 = +(subtotal - eb - target).toFixed(2);
    }

    const total = +(subtotal - eb - u18).toFixed(2);

    sSub.textContent = fmt(subtotal);
    sEb.textContent  = eb ? '-'+fmt(eb).slice(1) : '-0.00';
    sU18.textContent = u18 ? '-'+fmt(u18).slice(1) : '-0.00';
    sTotal.textContent = fmt(total);

    // keep fallback form in sync
    const sku = 'EDN-MINI-EM-001';
    el('pp-amount').value = total.toFixed(2);
    el('pp-custom').value = JSON.stringify({sku, under18:under18.checked, code:codeVal});
    return { total, sku, code: codeVal };
  }

  under18.addEventListener('change', compute);
  code.addEventListener('input', compute);
  compute();

  // ---------- Try to render PayPal Buttons (SDK path) ----------
  function renderButtons() {
    if (!window.paypal || !paypal.Buttons) {
      // SDK missing or blocked: show fail note + standard fallback
      el('paypal-fail').style.display = 'block';
      el('pp-standard').style.display = 'block';
      return;
    }

    paypal.Buttons({
      style: { layout: 'vertical', shape: 'rect' },
      createOrder: function(data, actions) {
        const state = compute();
        return actions.order.create({
          purchase_units: [{
            amount: { value: state.total.toFixed(2), currency_code: 'USD' },
            custom_id: state.sku,
            description: 'Mini Course: Edunancial Method'
          }],
          application_context: {
            brand_name: 'Edunancial',
            shipping_preference: 'NO_SHIPPING',
            user_action: 'PAY_NOW',
            return_url: 'https://www.edunancial.com/thank-you.html',
            cancel_url: 'https://www.edunancial.com/payments.html'
          }
        });
      },
      onApprove: function(data, actions) {
        return actions.order.capture().then(function() {
          window.location.href = '/thank-you.html?status=success&orderID=' + encodeURIComponent(data.orderID);
        });
      },
      onError: function() {
        // If something goes wrong mid-flow, reveal the backup button
        el('paypal-fail').style.display = 'block';
        el('pp-standard').style.display = 'block';
      }
    }).render('#paypal-container');
  }

  // Delay until SDK tag has a chance to execute
  if (document.readyState === 'complete' || document.readyState === 'interactive') {
    setTimeout(renderButtons, 50);
  } else {
    window.addEventListener('DOMContentLoaded', () => setTimeout(renderButtons, 50));
  }
})();
</script>

</body>
</html>
