<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Checkout — Edunancial</title>
  <meta name="robots" content="noindex" />
  <style>
    :root { --red:#c50000; --ink:#111; }
    * { box-sizing:border-box }
    body { margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:var(--ink); background:#fff; }
    header { background:var(--red); color:#000; font-weight:800; text-align:center; padding:14px 10px; letter-spacing:.5px; }
    main { max-width:720px; margin:24px auto 56px; padding:0 16px; }
    .card { border:1px solid #e6e6ea; border-radius:12px; padding:18px; box-shadow:0 6px 20px rgba(0,0,0,.04); }
    h1 { font-size:22px; margin:0 0 10px; }
    .sku { color:#555; margin:0 0 16px; }
    label { display:block; margin:12px 0 6px; font-weight:700; }
    input[type="text"] { width:100%; padding:10px 12px; border:1px solid #cfcfd6; border-radius:8px; font-size:16px; }
    .inline { display:flex; align-items:center; gap:10px; }
    .inline input[type="checkbox"] { width:20px; height:20px; }
    .rows { margin-top:10px }
    .row { display:flex; justify-content:space-between; margin:6px 0; }
    .total { font-weight:900; font-size:22px; margin-top:10px; }
    .muted { color:#666; font-size:14px; }
    #paypal-button-container { margin-top:18px; min-height:45px; }
    .error { display:none; margin-top:14px; padding:12px; border-left:4px solid #c50000; background:#fff4f4; color:#6b1111; border-radius:6px; }
    .help  { display:none; margin-top:12px; padding:12px; border:1px solid #e53935; background:#ffebee; color:#b71c1c; border-radius:6px; font-size:.95rem; }
    .fallback { display:none; margin-top:14px; }
    .btn-plain {
      appearance:none; border:0; background:#ffc439; color:#111; font-weight:800;
      padding:12px 16px; border-radius:8px; width:100%; cursor:pointer;
    }
  </style>

  <!-- PayPal JS SDK — LIVE -->
  <script src="https://www.paypal.com/sdk/js?client-id=AX2d6TWWguiffoGPIhKQg5D4avOwsBajcdl-S2tJ7mAHckP_sxucKRXdCgYyyQRQYqKGvWlE2wx4GAxw&currency=USD&components=buttons"></script>
</head>
<body>
  <header>EDUNANCIAL CHECKOUT</header>

  <main>
    <div class="card">
      <h1>Mini Course: Edunancial Method</h1>
      <p class="sku">SKU: <strong>EDN-MINI-EM-001</strong></p>

      <div class="inline">
        <input type="checkbox" id="under18">
        <label for="under18" style="margin:0">I am under 18</label>
      </div>

      <label for="code">Discount / Under-18 Code</label>
      <input id="code" type="text" placeholder="Enter code (use PR12345$$ for your $1 test)" inputmode="text" autocomplete="off" />

      <div class="rows">
        <div class="row"><span>Subtotal</span>     <span id="subtotal">$75.00</span></div>
        <div class="row"><span>Early-bird</span>    <span id="earlybird">-$11.25</span></div>
        <div class="row"><span>Under-18 code</span> <span id="u18line">-$0.00</span></div>
        <div class="row total"><span>Total</span>   <span id="total">$63.75</span></div>
      </div>

      <!-- PayPal Smart Buttons -->
      <div id="paypal-button-container"></div>
      <div id="pp-error" class="error"></div>

      <!-- Fallback guidance -->
      <div id="paypal-help" class="help">
        ⚠️ The PayPal checkout button didn’t load.<br><br>
        Please disable <strong>ad-blockers</strong> or <strong>Private DNS</strong> on your phone/browser, or try switching between Wi-Fi and mobile data.  
        Then refresh this page. (Allow scripts from <em>paypal.com</em>.)
      </div>

      <!-- CLASSIC PAYPAL FALLBACK (No JS from PayPal required) -->
      <form id="classic-form" class="fallback" action="https://www.paypal.com/cgi-bin/webscr" method="post">
        <!-- Replace the value below with your PayPal business email or merchant ID (only if you want this fallback active) -->
        <input type="hidden" name="business" id="pp-business" value="YOUR_PAYPAL_BUSINESS_EMAIL_OR_MERCHANT_ID">
        <input type="hidden" name="cmd" value="_xclick">
        <input type="hidden" name="item_name" id="pp-item" value="Edunancial Mini Course (EN)">
        <input type="hidden" name="item_number" id="pp-sku"  value="EDN-MINI-EM-001">
        <input type="hidden" name="currency_code" value="USD">
        <input type="hidden" name="amount" id="pp-amount" value="75.00">
        <input type="hidden" name="return" value="https://www.edunancial.com/thank-you.html">
        <button type="submit" class="btn-plain">Pay with PayPal (fallback)</button>
        <div class="muted" style="margin-top:6px">This alternate button appears only if PayPal’s script is blocked.</div>
      </form>

      <p class="agree">By paying you agree to our <a href="/terms.html">Terms</a> and <a href="/refunds.html">Refunds</a>.</p>
    </div>
  </main>

  <script>
    // ------- Pricing / Discount logic (shared by both flows) -------
    const SUBTOTAL  = 75.00;
    const EARLYBIRD = 11.25;        // your early-bird reduction
    const TEST_CODE = "PR12345$$";  // only with "under 18" → total becomes $1.00

    const $u18   = document.getElementById('under18');
    const $code  = document.getElementById('code');
    const $uLine = document.getElementById('u18line');
    const $tot   = document.getElementById('total');

    function fmt(n){ return '$' + Number(n).toFixed(2); }

    function calcTotal(){
      let u18Disc = 0;
      if ($u18.checked && $code.value.trim() === TEST_CODE) {
        const current = SUBTOTAL - EARLYBIRD;
        u18Disc = Math.max(0, current - 1.00);  // force $1.00 total
      }
      $uLine.textContent = '-' + (u18Disc ? fmt(u18Disc).slice(1) : '0.00');
      const total = Math.max(0.01, (SUBTOTAL - EARLYBIRD - u18Disc));
      $tot.textContent = fmt(total);
      return Number(total.toFixed(2));
    }

    document.getElementById('subtotal').textContent  = fmt(SUBTOTAL);
    document.getElementById('earlybird').textContent = '-' + fmt(EARLYBIRD).slice(1);
    ['change','keyup'].forEach(ev => {
      $u18.addEventListener(ev, calcTotal);
      $code.addEventListener(ev, calcTotal);
    });
    calcTotal();

    // ------- Smart Buttons (primary path) -------
    const $help = document.getElementById('paypal-help');
    const $err  = document.getElementById('pp-error');
    const $classic = document.getElementById('classic-form');
    const $classicAmt = document.getElementById('pp-amount');

    function renderPayPal(){
      if (!window.paypal || !paypal.Buttons) {
        // Show guidance + classic fallback
        $help.style.display = 'block';
        // If merchant email/ID is set, reveal classic button and set amount from current total
        if (document.getElementById('pp-business').value !== 'YOUR_PAYPAL_BUSINESS_EMAIL_OR_MERCHANT_ID') {
          $classicAmt.value = calcTotal().toFixed(2);
          $classic.style.display = 'block';
        }
        return;
      }

      $help.style.display = 'none';
      $classic.style.display = 'none';
      $err.style.display = 'none';

      paypal.Buttons({
        style: { layout:'vertical', color:'gold', shape:'rect', label:'paypal' },

        createOrder: function(data, actions){
          const amount = calcTotal();
          if (amount < 1) {
            $err.textContent = 'Total must be at least $1.00.';
            $err.style.display = 'block';
            throw new Error('Total below 1.00');
          }
          return actions.order.create({
            purchase_units: [{
              description: 'Edunancial Mini Course (EN)',
              custom_id: 'EDN-MINI-EM-001',
              amount: { currency_code:'USD', value: amount.toFixed(2) }
            }]
          });
        },

        onApprove: function(data, actions){
          return actions.order.capture().then(function(details){
            const params = new URLSearchParams({
              orderId: details.id || '',
              paid:    calcTotal().toFixed(2),
              payer:   (details.payer && details.payer.name && details.payer.name.given_name) || 'Customer'
            }).toString();
            window.location.href = '/thank-you.html?' + params;
          });
        },

        onError: function(err){
          $err.textContent = 'PayPal error: ' + (err && err.message ? err.message : 'Unknown error.');
          $err.style.display = 'block';
          // Offer classic fallback if merchant ID provided
          if (document.getElementById('pp-business').value !== 'YOUR_PAYPAL_BUSINESS_EMAIL_OR_MERCHANT_ID') {
            $classicAmt.value = calcTotal().toFixed(2);
            $classic.style.display = 'block';
          } else {
            $help.style.display = 'block';
          }
        }
      }).render('#paypal-button-container').catch(function(){
        // Render failed (likely blocked): show guidance + classic
        $help.style.display = 'block';
        if (document.getElementById('pp-business').value !== 'YOUR_PAYPAL_BUSINESS_EMAIL_OR_MERCHANT_ID') {
          $classicAmt.value = calcTotal().toFixed(2);
          $classic.style.display = 'block';
        }
      });
    }

    document.addEventListener('DOMContentLoaded', function(){
      renderPayPal();
      // If SDK is slow/blocked, show fallback in 5s
      setTimeout(function(){
        const iframePresent = document.querySelector('#paypal-button-container iframe');
        if (!iframePresent) {
          $help.style.display = 'block';
          if (document.getElementById('pp-business').value !== 'YOUR_PAYPAL_BUSINESS_EMAIL_OR_MERCHANT_ID') {
            $classicAmt.value = calcTotal().toFixed(2);
            $classic.style.display = 'block';
          }
        }
      }, 5000);
    });
  </script>
</body>
</html>
