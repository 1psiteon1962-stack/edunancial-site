<!doctype html><html lang="es"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Pago — Edunancial</title>
<link rel="stylesheet" href="/style.css">
<style>
  .form-row{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
  .codebox{display:inline-flex;gap:8px}
  .total{font-size:22px;font-weight:800;margin:12px 0}
</style>
</head><body>
<div id="sitebar"></div>

<main class="container">
  <h1>Pago</h1>
  <p id="skuLine"></p>

  <div class="form-row">
    <label><input type="checkbox" id="ageChk"> Soy menor de 18</label>
    <span>|</span>
    <div class="codebox">
      <label for="code">Código de descuento / menor de 18:</label>
      <input id="code" type="text" inputmode="text" placeholder="Ingrese código">
      <button id="apply" class="btn">Aplicar</button>
    </div>
  </div>

  <div class="total">Total: <span id="total">$0.00</span></div>

  <a id="payLink" class="btn btn-primary" href="#">Continuar a PayPal</a>
  <p class="muted">Al pagar acepta nuestros <a href="/es-terms.html">Términos</a> y <a href="/es-refunds.html">Reembolsos</a>.</p>
</main>

<script src="/header.js"></script>
<script>
(function(){
  const params = new URLSearchParams(location.search);
  const sku = params.get('sku') || 'DESCONOCIDO';
  const base = Number(params.get('price') || 0);
  const skuLine = document.getElementById('skuLine');
  const totalEl = document.getElementById('total');
  const ageChk = document.getElementById('ageChk');
  const codeEl = document.getElementById('code');
  const applyBtn = document.getElementById('apply');
  const payLink = document.getElementById('payLink');

  skuLine.textContent = 'SKU: ' + sku;
  let total = base;
  render();

  applyBtn.onclick = (e)=>{
    e.preventDefault();
    const code = (codeEl.value||'').trim().toUpperCase();
    const validCodes = ['PR18','TEST3','EDN3'];
    if (ageChk.checked && validCodes.includes(code)) {
      total = 3.00;
      render();
    } else {
      alert('Código inválido o faltante. Total sin cambios.');
    }
  };

  function render(){
    totalEl.textContent = `$${total.toFixed(2)}`;
    const query = new URLSearchParams({ sku, amount: total.toFixed(2) }).toString();
    const baseUrl = window.PAYPAL_URL_BASE || "/.netlify/functions/paypal-checkout";
    document.getElementById('payLink').href = `${baseUrl}?${query}`;
  }
})();
</script>
</body></html>
