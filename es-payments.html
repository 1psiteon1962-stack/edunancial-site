<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pago — Edunancial</title>
<link rel="stylesheet" href="style.css" />
<style>
  :root{--red:#c00;--blue:#002b5c}
  body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#f7f7f9}
  header{background:var(--red);color:#000;text-align:center;padding:12px 16px;font-weight:800}
  main{max-width:900px;margin:24px auto;padding:0 16px}
  .card{background:#fff;border:1px solid #e3e3e3;border-radius:14px;padding:18px 20px;margin-bottom:16px}
  .row{display:flex;gap:14px;flex-wrap:wrap}
  .col{flex:1 1 260px}
  label{display:block;font-weight:700;margin:.35rem 0}
  select,input[type="text"]{width:100%;padding:.55rem .7rem;border:1px solid #ccc;border-radius:8px}
  .total{font-size:1.25rem;font-weight:800}
  .muted{opacity:.8}
  .note{font-size:.9rem}
</style>
</head>
<body>
<header>PAGO DE EDUNANCIAL</header>

<main>
  <div id="summary" class="card">
    <h1 id="title">Pago</h1>
    <p id="skuLine" class="muted"></p>
    <div class="row">
      <div class="col">
        <div class="card">
          <label for="membership">Membresía</label>
          <select id="membership">
            <option value="0">Ninguna (0%)</option>
            <option value="10">Estándar (10% dto.)</option>
            <option value="20">Pro (20% dto.)</option>
          </select>
          <p class="note muted">
            Early-bird: 15% de descuento hasta <strong>26/09/2025</strong>. Se aplica automáticamente.
          </p>
        </div>
      </div>
      <div class="col">
        <div class="card">
          <div class="muted">Subtotal: <span id="subtotal">$0.00</span></div>
          <div class="muted">Descuento membresía: <span id="membdisc">-$0.00</span></div>
          <div class="muted">Early-bird: <span id="ebdisc">-$0.00</span></div>
          <div class="total">Total: <span id="total">$0.00</span></div>
        </div>
        <div class="card">
          <div id="paypal-button-container"></div>
          <p class="note muted">Al pagar aceptas nuestros <a href="es-terms.html">Términos</a> y <a href="es-refunds.html">Reembolsos</a>.</p>
        </div>
      </div>
    </div>
  </div>
</main>

<script>
  const params = new URLSearchParams(location.search);
  const item = decodeURIComponent(params.get('item') || 'Producto Edunancial');
  const sku  = params.get('sku')  || 'EDN-ITEM';
  const base = parseFloat(params.get('price') || '0');

  document.getElementById('title').textContent = item;
  document.getElementById('skuLine').textContent = `SKU: ${sku} • Base: $${base.toFixed(2)}`;

  const els = {
    subtotal: document.getElementById('subtotal'),
    membdisc: document.getElementById('membdisc'),
    ebdisc:   document.getElementById('ebdisc'),
    total:    document.getElementById('total'),
    membership: document.getElementById('membership')
  };

  const earlyBirdDeadline = new Date('2025-09-26T23:59:59-05:00');

  function calc() {
    const subtotal = base;
    const membPct = parseFloat(els.membership.value || '0');
    let membDisc = subtotal * (membPct/100);
    let ebDisc = 0;
    if (new Date() <= earlyBirdDeadline) ebDisc = subtotal * 0.15;

    let total = Math.max(0, subtotal - membDisc - ebDisc);

    els.subtotal.textContent = `$${subtotal.toFixed(2)}`;
    els.membdisc.textContent = `-$${membDisc.toFixed(2)}`;
    els.ebdisc.textContent   = `-$${ebDisc.toFixed(2)}`;
    els.total.textContent    = `$${total.toFixed(2)}`;

    return { total };
  }

  ['change','keyup'].forEach(ev => els.membership.addEventListener(ev, calc));
  let currentTotals = calc();
</script>

<script src="https://www.paypal.com/sdk/js?client-id=YOUR_LIVE_PAYPAL_CLIENT_ID_HERE&currency=USD&intent=capture"></script>
<script>
  function amount(){ currentTotals = (typeof calc==='function')?calc():currentTotals; return currentTotals.total.toFixed(2); }

  paypal.Buttons({
    style:{layout:'vertical',color:'gold',shape:'rect',label:'paypal'},
    createOrder: function(data, actions) {
      return actions.order.create({
        purchase_units: [{ description: `${item} (SKU: ${sku})`, amount:{currency_code:'USD', value: amount()} }]
      });
    },
    onApprove: function(data, actions) {
      return actions.order.capture().then(function(details){
        const q = new URLSearchParams({ item, sku, paid: amount(), orderId: data.orderID, payer: details.payer?.name?.given_name || 'Cliente' }).toString();
        location.href = `es-thank-you.html?${q}`;
      });
    },
    onError: err => alert('Error en el pago: ' + (err && err.message ? err.message : err))
  }).render('#paypal-button-container');
</script>
</body>
</html>
