<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Checkout — Edunancial</title>
<link rel="stylesheet" href="style.css" />
<style>
  :root{--red:#c00;--blue:#002b5c}
  body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#f7f7f9}
  header{background:var(--red);color:#000;text-align:center;padding:12px 16px;font-weight:800}
  main{max-width:900px;margin:24px auto;padding:0 16px}
  .card{background:#fff;border:1px solid #e3e3e3;border-radius:14px;padding:18px 20px;margin-bottom:16px}
  .row{display:flex;gap:14px;flex-wrap:wrap}
  .col{flex:1 1 260px}
  label{display:block;font-weight:700;margin:.35rem 0}
  select,input[type="text"]{width:100%;padding:.55rem .7rem;border:1px solid #ccc;border-radius:8px}
  .total{font-size:1.25rem;font-weight:800}
  .muted{opacity:.8}
  .note{font-size:.9rem}
  .btn{display:inline-block;background:var(--blue);color:#fff;padding:.6rem 1rem;border-radius:8px;text-decoration:none}
  .stack > *{margin:.35rem 0}
</style>
</head>
<body>
<header>EDUNANCIAL CHECKOUT</header>

<main>
  <div id="summary" class="card">
    <h1 id="title">Checkout</h1>
    <p id="skuLine" class="muted"></p>
    <div class="row">
      <div class="col">
        <div class="card">
          <div class="stack">
            <label for="membership">Membership</label>
            <select id="membership">
              <option value="0">None (0%)</option>
              <option value="10">Standard (10% off)</option>
              <option value="20">Pro (20% off)</option>
            </select>

            <label><input type="checkbox" id="under18" /> I am under 18</label>
            <label for="code">Discount / Under-18 Code</label>
            <input type="text" id="code" placeholder="Enter code (optional)" />

            <p class="note muted">
              Early-bird: 15% off through <strong>09/26/2025</strong> applies automatically.
            </p>
          </div>
        </div>
      </div>

      <div class="col">
        <div class="card">
          <div class="stack">
            <div class="muted">Subtotal: <span id="subtotal">$0.00</span></div>
            <div class="muted">Membership discount: <span id="membdisc">-$0.00</span></div>
            <div class="muted">Early-bird: <span id="ebdisc">-$0.00</span></div>
            <div class="muted">Under-18 code: <span id="u18disc">-$0.00</span></div>
            <div class="total">Total: <span id="total">$0.00</span></div>
          </div>
        </div>
        <div class="card">
          <div id="paypal-button-container"></div>
          <p class="note muted">By paying you agree to our <a href="terms.html">Terms</a> and <a href="refunds.html">Refunds</a>.</p>
        </div>
      </div>
    </div>
  </div>
</main>

<script>
  // ----- Read item details from URL -----
  const params = new URLSearchParams(location.search);
  const item = decodeURIComponent(params.get('item') || 'Edunancial Item');
  const sku  = params.get('sku')  || 'EDN-ITEM';
  const base = parseFloat(params.get('price') || '0');

  document.getElementById('title').textContent = item;
  document.getElementById('skuLine').textContent = `SKU: ${sku} • Base: $${base.toFixed(2)}`;

  const els = {
    subtotal: document.getElementById('subtotal'),
    membdisc: document.getElementById('membdisc'),
    ebdisc:   document.getElementById('ebdisc'),
    u18disc:  document.getElementById('u18disc'),
    total:    document.getElementById('total'),
    membership: document.getElementById('membership'),
    under18: document.getElementById('under18'),
    code: document.getElementById('code')
  };

  // Early-bird deadline (inclusive)
  const earlyBirdDeadline = new Date('2025-09-26T23:59:59-05:00'); // adjust TZ if needed

  function calc() {
    const subtotal = base;
    const membPct = parseFloat(els.membership.value || '0');

    let membDisc = subtotal * (membPct/100);

    let ebDisc = 0;
    if (new Date() <= earlyBirdDeadline) {
      ebDisc = subtotal * 0.15; // 15% early-bird through 9/26/2025
    }

    // Under-18 code: ONLY this exact code yields $1 total (English page only)
    let u18Disc = 0;
    const code = (els.code.value || '').trim();
    const wantsU18 = els.under18.checked;

    let total = subtotal - membDisc - ebDisc;

    if (wantsU18 && code === 'PR12345$$') {
      u18Disc = Math.max(0, total - 1.00); // drive net to $1.00
      total = 1.00;
    } else {
      total = Math.max(0, total); // floor at 0
    }

    els.subtotal.textContent = `$${subtotal.toFixed(2)}`;
    els.membdisc.textContent = `-$${membDisc.toFixed(2)}`;
    els.ebdisc.textContent   = `-$${ebDisc.toFixed(2)}`;
    els.u18disc.textContent  = `-$${u18Disc.toFixed(2)}`;
    els.total.textContent    = `$${total.toFixed(2)}`;

    return { subtotal, membDisc, ebDisc, u18Disc, total };
  }

  ['change','keyup'].forEach(ev=>{
    els.membership.addEventListener(ev, calc);
    els.under18.addEventListener(ev, calc);
    els.code.addEventListener(ev, calc);
  });

  // initial calc before PayPal loads
  let currentTotals = calc();
</script>

<!-- LIVE PayPal SDK (replace client-id!) -->
<script src="https://www.paypal.com/sdk/js?client-id=YOUR_LIVE_PAYPAL_CLIENT_ID_HERE&currency=USD&intent=capture"></script>
<script>
  function amount() {
    // recalc right before createOrder
    currentTotals = (typeof calc === 'function') ? calc() : currentTotals;
    return currentTotals.total.toFixed(2);
  }

  paypal.Buttons({
    style: { layout: 'vertical', color: 'gold', shape: 'rect', label: 'paypal' },

    createOrder: function(data, actions) {
      const value = amount();
      return actions.order.create({
        purchase_units: [{
          description: `${item} (SKU: ${sku})`,
          amount: { currency_code: 'USD', value }
        }]
      });
    },

    onApprove: function(data, actions) {
      return actions.order.capture().then(function(details) {
        // Redirect to thank-you with receipt info
        const q = new URLSearchParams({
          item, sku, paid: amount(), orderId: data.orderID, payer: details.payer?.name?.given_name || 'Customer'
        }).toString();
        location.href = `thank-you.html?${q}`;
      });
    },

    onError: function(err) {
      alert('Payment error: ' + (err && err.message ? err.message : err));
    }
  }).render('#paypal-button-container');
</script>
</body>
</html>
