<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Edunancial — Checkout</title>
  <link rel="stylesheet" href="/style.css" />
  <style>
    .wrap{max-width:720px;margin:0 auto;padding:1.25rem}
    .summary{border:1px solid #e5e5e5;border-radius:12px;padding:1rem;margin:1rem 0}
    .row{display:flex;justify-content:space-between;gap:12px;margin:.35rem 0}
    .total{font-size:1.35rem;font-weight:700}
    .muted{color:#666}
    .notice{background:#fff3cd;border:1px solid #ffeeba;border-radius:8px;padding:.6rem .8rem;margin:.75rem 0}
  </style>
</head>
<body>
  <main class="wrap">
    <a href="/our-story.html" class="muted">← Back</a>
    <h1>Checkout</h1>

    <div id="paywall" class="notice" style="display:none">
      <strong>Action needed:</strong> Add your PayPal <em>Live</em> Client ID into the script URL in this file
      (look for <code>client-id=YOUR_PAYPAL_CLIENT_ID</code>). Then redeploy.
    </div>

    <div class="summary">
      <div class="row"><div>Plan</div><div id="planName">Basic</div></div>
      <div class="row"><div>Billing</div><div>Monthly</div></div>
      <div class="row total"><div>Total due today</div><div id="total">$9.99</div></div>
      <div class="muted">You can cancel anytime in your account. No shipping or taxes.</div>
    </div>

    <!-- Where PayPal smart buttons render -->
    <div id="paypal-buttons"></div>

    <div id="result" class="notice" style="display:none"></div>
  </main>

  <!-- Replace YOUR_PAYPAL_CLIENT_ID with your LIVE client ID (not sandbox) -->
  <script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID&currency=USD&intent=capture"></script>

  <script>
    // --- Read price/plan from URL (our links already include these) ---
    const params = new URLSearchParams(location.search);
    const plan  = (params.get('plan') || 'basic').toLowerCase();
    // price from URL, else fallback to 9.99
    const price = Number(params.get('price')) > 0 ? Number(params.get('price')) : 9.99;

    document.getElementById('planName').textContent =
      plan === 'growth' ? 'Growth' : plan === 'pro' ? 'Pro' : 'Basic';
    document.getElementById('total').textContent = `$${price.toFixed(2)}`;

    // Quick check so we don't confuse you if the client-id wasn't set
    (function ensureClientId() {
      const src = document.currentScript?.previousElementSibling?.src || '';
      if (src.includes('YOUR_PAYPAL_CLIENT_ID')) {
        document.getElementById('paywall').style.display = 'block';
      }
    })();

    // --- PayPal Smart Buttons ---
    if (window.paypal) {
      paypal.Buttons({
        style: { layout: 'vertical', shape: 'rect', label: 'paypal' },

        createOrder: function(data, actions) {
          return actions.order.create({
            intent: 'CAPTURE',
            purchase_units: [{
              description: `Edunancial ${plan.charAt(0).toUpperCase() + plan.slice(1)} (Monthly)`,
              amount: { currency_code: 'USD', value: price.toFixed(2) }
            }],
            application_context: {
              brand_name: "Edunancial",
              shipping_preference: "NO_SHIPPING",
              user_action: "PAY_NOW",
              return_url: location.origin + "/thank-you.html",
              cancel_url: location.href
            }
          });
        },

        onApprove: function(data, actions) {
          return actions.order.capture().then(function(details) {
            const name = details.payer?.name?.given_name || 'Member';
            const id   = details.id;
            const el   = document.getElementById('result');
            el.innerHTML = `<strong>Thank you, ${name}!</strong> Your payment (Order <code>${id}</code>) was captured successfully.`;
            el.style.display = 'block';
            // Optionally redirect to your thank-you page:
            setTimeout(() => location.href = "/thank-you.html?plan=" + plan + "&price=" + price.toFixed(2), 1000);
          });
        },

        onCancel: function () {
          const el = document.getElementById('result');
          el.innerHTML = "Checkout was canceled. You can try again.";
          el.style.display = 'block';
        },

        onError: function (err) {
          const el = document.getElementById('result');
          el.innerHTML = "We couldn't complete the payment. Please try again or use a different method.";
          el.style.display = 'block';
          console.error(err);
        }
      }).render('#paypal-buttons');
    }
  </script>
</body>
</html>
