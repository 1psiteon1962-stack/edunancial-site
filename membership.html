<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Membership Checkout</title>
  <!-- PayPal SDK: use LIVE client id when ready -->
  <script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID&currency=USD"></script>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;background:#0f172a;color:#e5e7eb}
    .wrap{max-width:960px;margin:0 auto;padding:24px 16px}
    h1{margin:0 0 8px}
    .grid{display:grid;grid-template-columns:1fr;gap:14px;margin-top:16px}
    @media(min-width:800px){.grid{grid-template-columns:1.4fr .6fr}}
    .card{background:#111827;border:1px solid rgba(148,163,184,.25);border-radius:14px;padding:16px}
    .row{display:flex;align-items:center;justify-content:space-between;margin:8px 0}
    .qty{display:flex;gap:6px;align-items:center}
    .qty input{width:64px;padding:6px;border-radius:8px;border:1px solid rgba(148,163,184,.35);background:#0b1020;color:#e5e7eb}
    .muted{color:#cbd5e1}
    .total{font-size:20px;font-weight:800}
    .ok{color:#22c55e}.warn{color:#f59e0b}.err{color:#ef4444}
    .note{font-size:13px;color:#cbd5e1;margin-top:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Checkout</h1>
    <p class="muted">Choose the membership plan that works best for your situation. You can upgrade at any time.</p>

    <div class="grid">
      <!-- Products / Memberships -->
      <div class="card">
        <h2>Plans & Add-ons</h2>

        <div class="row">
          <div>
            <strong>Entry Membership</strong> <span class="muted">($9.99 / month)</span><br>
            <span class="muted">Library access + pamphlet + 15% coupon</span>
          </div>
          <div class="qty">
            <label for="qty-entry" class="muted">Qty</label>
            <input id="qty-entry" type="number" min="0" max="10" value="1">
          </div>
        </div>

        <div class="row">
          <div>
            <strong>Standard Membership</strong> <span class="muted">($29.00 / month)</span><br>
            <span class="muted">Full library, tools, coaching</span>
          </div>
          <div class="qty">
            <label for="qty-standard" class="muted">Qty</label>
            <input id="qty-standard" type="number" min="0" max="10" value="0">
          </div>
        </div>

        <div class="row">
          <div>
            <strong>Premium Membership</strong> <span class="muted">($59.00 / month)</span><br>
            <span class="muted">Everything + monthly live calls + bigger discounts</span>
          </div>
          <div class="qty">
            <label for="qty-premium" class="muted">Qty</label>
            <input id="qty-premium" type="number" min="0" max="10" value="0">
          </div>
        </div>

        <div class="row">
          <div>
            <strong>Mini-Course Add-On</strong> <span class="muted">($75.00 one-time)</span><br>
            <span class="muted">Livestream + replay access</span>
          </div>
          <div class="qty">
            <label for="qty-course" class="muted">Qty</label>
            <input id="qty-course" type="number" min="0" max="10" value="0">
          </div>
        </div>

        <p class="note">Note: Memberships are shown here as one-time demo items to verify checkout flow. For **true monthly billing**, switch to <em>PayPal Subscriptions</em> after we confirm publish + capture + webhook.</p>
      </div>

      <!-- Summary + PayPal -->
      <div class="card">
        <h2>Order Summary</h2>
        <div id="summary" class="muted">No items selected.</div>
        <div class="row total"><span>Total</span><span id="total">$0.00</span></div>
        <div id="paypal-button-container" style="margin-top:12px;"></div>
        <div id="status" class="note"></div>
      </div>
    </div>
  </div>

  <script>
    // ---- Cart logic (client-side) ----
    const items = [
      { id: 'entry',    name: 'Entry Membership',    price: 9.99,  type: 'onetime' },
      { id: 'standard', name: 'Standard Membership', price: 29.00, type: 'onetime' },
      { id: 'premium',  name: 'Premium Membership',  price: 59.00, type: 'onetime' },
      { id: 'course',   name: 'Mini-Course Add-On',  price: 75.00, type: 'onetime' }
    ];
    const inputs = {
      entry:    document.getElementById('qty-entry'),
      standard: document.getElementById('qty-standard'),
      premium:  document.getElementById('qty-premium'),
      course:   document.getElementById('qty-course')
    };
    const $summary = document.getElementById('summary');
    const $total   = document.getElementById('total');
    const $status  = document.getElementById('status');

    function format(n){ return '$' + n.toFixed(2); }

    function getCart(){
      const cart = [];
      let total = 0;
      items.forEach(it=>{
        const qty = Math.max(0, parseInt(inputs[it.id].value||0,10));
        if(qty>0){
          cart.push({
            name: it.name,
            unit_amount: it.price,
            quantity: qty
          });
          total += it.price * qty;
        }
      });
      return {cart, total};
    }

    function renderSummary(){
      const {cart, total} = getCart();
      if(cart.length===0){
        $summary.textContent = 'No items selected.';
      }else{
        $summary.innerHTML = cart.map(i=>`${i.quantity} × ${i.name} — ${format(i.unit_amount*i.quantity)}`).join('<br>');
      }
      $total.textContent = format(total);
    }

    Object.values(inputs).forEach(inp=> inp.addEventListener('input', renderSummary));
    renderSummary();

    // ---- PayPal Buttons ----
    paypal.Buttons({
      style: { layout: 'vertical', shape: 'rect', label: 'paypal' },

      // Create an order with multiple line items
      createOrder: function(data, actions) {
        const {cart, total} = getCart();
        if(cart.length===0){
          $status.innerHTML = '<span class="warn">Please add at least one item.</span>';
          return;
        }
        const purchaseItems = cart.map(i=>({
          name: i.name,
          quantity: String(i.quantity),
          unit_amount: { currency_code: 'USD', value: i.unit_amount.toFixed(2) }
        }));

        return actions.order.create({
          intent: 'CAPTURE',
          purchase_units: [{
            amount: {
              currency_code: 'USD',
              value: total.toFixed(2),
              breakdown: {
                item_total: { currency_code: 'USD', value: total.toFixed(2) }
              }
            },
            items: purchaseItems
          }]
        });
      },

      // Capture on client (instant UX), webhook will verify server-side
      onApprove: async function(data, actions) {
        const details = await actions.order.capture();
        $status.innerHTML = '<span class="ok">Payment captured. Thank you!</span>';

        // OPTIONAL: ping your backend for post-processing (don’t block UX if it fails)
        try{
          await fetch('/api/health');
        }catch(e){}
      },

      onError: function(err){
        console.error(err);
        $status.innerHTML = '<span class="err">There was a problem processing your payment.</span>';
      }
    }).render('#paypal-button-container');
  </script>
</body>
</html>
