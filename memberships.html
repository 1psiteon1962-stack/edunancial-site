<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Edunancial — Memberships</title>
<style>
  :root{--ed-red:#e53935}
  body{margin:0;font:16px/1.6 system-ui,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:960px;margin:auto;padding:16px}
  header{position:sticky;top:0;background:#fff;border-bottom:1px solid #eee}
  nav{display:flex;gap:16px;align-items:center}
  a{color:#222;text-decoration:none;font-weight:700}
  .grid{display:grid;gap:16px}
  @media(min-width:900px){.grid{grid-template-columns:repeat(3,1fr)}}
  .card{border:1px solid #eee;border-radius:16px;padding:20px;box-shadow:0 8px 24px rgba(0,0,0,.06)}
  .price{font-size:40px;font-weight:800;margin:0 0 8px}
  .btn{display:inline-block;background:var(--ed-red);color:#fff;padding:12px 18px;border-radius:12px;font-weight:800}
  .tap{min-width:44px;min-height:44px;display:inline-flex;align-items:center;justify-content:center}
  .note{color:#666}
</style>
</head>
<body>
<header><div class="wrap"><nav>
  <a href="/index.html" class="tap">Edunancial</a>
  <a href="/memberships.html" class="tap">Memberships</a>
  <a href="/catalog.html" class="tap">Catalog</a>
</nav></div></header>

<main class="wrap">
  <h1>Choose Your Membership</h1>
  <p class="note">Upgrade anytime. Cancel anytime from your PayPal account.</p>

  <div class="grid">
    <section class="card">
      <h2>Basic</h2>
      <p class="price">$9.99<span class="note">/mo</span></p>
      <ul>
        <li>Member pricing on courses & paperback books</li>
        <li>Members-only downloads</li>
      </ul>
      <div id="pp-basic"></div>
    </section>

    <section class="card">
      <h2>Growth</h2>
      <p class="price">$19.99<span class="note">/mo</span></p>
      <ul>
        <li>Everything in Basic</li>
        <li>Priority email/chat support</li>
      </ul>
      <div id="pp-growth"></div>
    </section>

    <section class="card">
      <h2>Pro</h2>
      <p class="price">$29.99<span class="note">/mo</span></p>
      <ul>
        <li>Everything in Growth</li>
        <li>Deeper member discounts</li>
      </ul>
      <div id="pp-pro"></div>
    </section>
  </div>

  <p style="margin-top:24px"><a class="btn tap" href="/catalog.html">Browse Catalog</a></p>
</main>

<!-- PayPal JS (LIVE client ID) -->
<script src="https://www.paypal.com/sdk/js?client-id=PAYPAL_CLIENT_ID_LIVE&vault=true&intent=subscription"></script>
<script>
  // map PayPal plan ids
  const PLAN = {
    basic:  'PLAN_ID_BASIC',
    growth: 'PLAN_ID_GROWTH',
    pro:    'PLAN_ID_PRO'
  };

  function onApproveCommon(data, actions, planName){
    return actions.subscription.get().then(async (details)=>{
      try{
        const payer = details?.subscriber?.email_address ? {
          email: details.subscriber.email_address,
          name:  (details.subscriber.name?.given_name||'') + ' ' + (details.subscriber.name?.surname||'')
        } : {};
        if (payer.email) localStorage.setItem('ed_email', payer.email);

        // Set member cookie for 180 days
        document.cookie = "ed_member=1; path=/; max-age=" + (60*60*24*180);

        // Notify Netlify function → Make (Zapier-like)
        await fetch("/.netlify/functions/new-member", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({
            plan: planName,
            subscriptionId: data.subscriptionID,
            payer
          })
        });
      }catch(e){ console.warn(e); }
      // Go to catalog
      window.location.href = "/catalog.html";
    });
  }

  function renderButton(el, planName){
    paypal.Buttons({
      style:{ shape:'pill', color:'gold', layout:'vertical', label:'subscribe' },
      createSubscription: function(data, actions){
        return actions.subscription.create({ plan_id: PLAN[planName] });
      },
      onApprove: function(data, actions){
        return onApproveCommon(data, actions, planName);
      }
    }).render(el);
  }

  renderButton('#pp-basic','basic');
  renderButton('#pp-growth','growth');
  renderButton('#pp-pro','pro');
</script>

<!-- Tidio -->
<script src="https://code.tidio.co/YOUR_TIDIO_PUBLIC_KEY.js" async></script>
<script>
  document.addEventListener('tidioChat-ready', function(){
    const email = localStorage.getItem('ed_email')||'';
    if (window.tidioChatApi) window.tidioChatApi.setVisitorData({ email });
  });
</script>
</body>
</html>
