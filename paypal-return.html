<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>PayPal Return — Edunancial</title>
<link rel="stylesheet" href="/css/style.css">
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:20px}
  .wrap{max-width:980px;margin:0 auto}
  .card{border:1px solid #eee;padding:18px;border-radius:12px;margin:12px 0}
  pre{background:#f8f8f8;padding:12px;border-radius:8px;overflow:auto}
  .btn{display:inline-block;background:#0070ba;color:#fff;padding:10px 14px;border-radius:8px;text-decoration:none;font-weight:700}
  .btn.secondary{background:#444}
  .muted{color:#666;font-size:13px}
  .ok{color:#0a7a0a;font-weight:700}
  .warn{color:#a60;font-weight:700}
</style>
</head>
<body>
<div class="wrap">
  <h1>PayPal Return / Test Receiver</h1>

  <div class="card" id="statusCard">
    <h2>Status</h2>
    <p id="statusMsg" class="muted">Analyzing return parameters…</p>
    <p><a class="btn" href="/catalog.html">Go to Catalog</a> <a class="btn secondary" href="/memberships-en.html">Memberships</a></p>
  </div>

  <div class="card">
    <h2>Returned Query String</h2>
    <pre id="qs">Loading…</pre>
    <h2>Full URL</h2>
    <pre id="url">Loading…</pre>
    <p class="muted">For production, validate via IPN/PDT/Webhooks. This page is for redirect + cookie testing only.</p>
  </div>
</div>

<script>
(function(){
  function setCookie(name,value,days){
    const d=new Date(); d.setTime(d.getTime()+ (days*24*60*60*1000));
    document.cookie = name+"="+encodeURIComponent(value)+"; expires="+d.toUTCString()+"; path=/; SameSite=Lax";
  }
  function getParam(k){ return new URLSearchParams(location.search).get(k)||""; }
  function show(id,msg,cls){ const el=document.getElementById(id); if(el){ el.textContent=msg; if(cls) el.className=cls; } }

  document.addEventListener('DOMContentLoaded',()=>{
    const qs = location.search || '';
    document.getElementById('qs').textContent = qs || '(no query string)';
    document.getElementById('url').textContent = location.href;

    if(getParam('cancel')){ show('statusMsg','Payment canceled by user.','warn'); return; }

    const sub = getParam('sub');                 // Basic/Growth/Pro/Platinum/Elite
    const item = getParam('item');               // RedCart, BlueOneTime, etc.

    if(sub){
      const valid = ['BASIC','GROWTH','PRO','PLATINUM','ELITE'];
      const upper = sub.toUpperCase();
      if(valid.includes(upper)){
        setCookie('ed_member', upper, 30);
        show('statusMsg','Subscription detected: '+sub+' — cookie set (ed_member='+upper+') for 30 days. Member pricing unlocked on Catalog.','ok');
        return;
      }
    }
    if(item){
      setCookie('ed_access_'+item, '1', 1);
      show('statusMsg','One-time purchase detected: '+item+' — temporary access cookie set for 1 day.','ok');
      return;
    }
    show('statusMsg','No recognizable parameters found. Enable Auto Return or PDT/IPN to pass data.','warn');
  });
})();
</script>
</body>
</html>
